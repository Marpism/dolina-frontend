{"ast":null,"code":"import'./Tags.css';import{useEffect,useState}from'react';// import SearchForm from '../SearchForm/SearchForm';\nimport caret from'../../images/caret-down_mini.svg';import sorting from'../../images/sorting_2.svg';// import { NavLink } from 'react-router-dom';\nimport{useMediaQuery}from'react-responsive';import{NavLink,useLocation}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Tags(_ref){let{terms,tags,categories,onTagClick,onColorClick,activeCategory,activeTags,sortBy,setSortBy,sortOrder,setSortOrder,productFilters,setProductFilters,onCatClick}=_ref;const[selectedTags,setSelectedTags]=useState([]);const[filteredTags,setFilteredTags]=useState([]);const[selectedColors,setSelectedColors]=useState([]);const[openDropdownIndex,setOpenDropdownIndex]=useState(null);const[stonesInputValue,setStonesInputValue]=useState('');const[selectedCategoryName,setSelectedCategoryName]=useState('');const isBigScreen=useMediaQuery({minWidth:771});// надо бы перенести в константы\nconst isSmallScreen=useMediaQuery({maxWidth:770});const location=useLocation();const handleTagToggle=tag=>{let activeTagsTemporary=[];if(selectedTags.includes(tag)){activeTagsTemporary=selectedTags.filter(selectedTag=>selectedTag!==tag);}else{activeTagsTemporary=[...selectedTags,tag];}setSelectedTags(activeTagsTemporary);onTagClick(activeTagsTemporary);};// console.log(terms)\nfunction handleCategoryClick(event){event.preventDefault();const selectedCategoryId=event.target.dataset.id;onCatClick(selectedCategoryId);setOpenDropdownIndex(null);}const handleColorToggle=color=>{let activeColorsTemporary=[];if(selectedColors.includes(color)){activeColorsTemporary=selectedColors.filter(selectedColor=>selectedColor!==color);}else{activeColorsTemporary=[...selectedColors,color];}setSelectedColors(activeColorsTemporary);onColorClick(activeColorsTemporary);};const toggleDropdown=(index,event)=>{event.stopPropagation();// Останавливаем распространение события клика\nsetOpenDropdownIndex(prevIndex=>prevIndex===index?null:index);// Открываем или закрываем текущий выпадающий список\n};useEffect(()=>{if(tags){setFilteredTags(tags.filter(tag=>tag.count!==0));if(productFilters.category>0){const activeCategoryTags=JSON.parse(categories.filter(item=>item.termId==productFilters.category)[0].category_tags);setFilteredTags(tags.filter(tag=>activeCategoryTags.includes(Number(tag.termId))));}if(stonesInputValue.length>0){setFilteredTags(filteredTags.filter(tag=>tag.name.toLowerCase().includes(stonesInputValue.toLowerCase())));}else{}}},[tags,productFilters,stonesInputValue]);useEffect(()=>{if(productFilters.tags.length===0)setSelectedTags([]);if(productFilters.colors.length===0)setSelectedColors([]);},[productFilters]);useEffect(()=>{setSelectedColors(productFilters.colors);},[]);useEffect(()=>{setSelectedTags(productFilters.tags);},[]);useEffect(()=>{setSelectedCategoryName('');},[productFilters]);// useEffect(() => {\n// }, [filteredTags]);\nuseEffect(()=>{// Function to handle click events\nconst handleClick=event=>{const target=event.target;const parent=target.parentElement;// Check if the click target or its parent has the class 'tags__dropdown'\nif(!target.classList.contains('dropdown_selector')&&!(parent&&parent.classList.contains('dropdown_selector'))){setOpenDropdownIndex(null);// Закрываем выпадающий список\n}};// Add event listener to the document\ndocument.addEventListener('click',handleClick);// Cleanup event listener on component unmount\nreturn()=>{document.removeEventListener('click',handleClick);};},[]);// useEffect(() => {\n//   // Извлекаем categoryId из URL\n//   const query = new URLSearchParams(location.search);\n//   const categoryId = query.get('category');\n//   if (categoryId) {\n//     const category = terms.categories.find(cat => cat.termId === parseInt(categoryId));\n//     if (category) {\n//       setSelectedCategoryName(category.name);\n//     }\n//   }\n// }, [location.search, terms.categories]);\nuseEffect(()=>{// Извлекаем categoryId из URL\nconst query=new URLSearchParams(location.search);const categoryId=query.get('category');if(categoryId&&terms.categories){const category=terms.categories.find(cat=>cat.termId===parseInt(categoryId));if(category){setSelectedCategoryName(category.name);}}},[location.search,terms.categories]);function handleStonesInput(input){const inputValue=input.target.value;setStonesInputValue(inputValue);}const handleSortChange=value=>{setProductFilters(prevFilters=>({...prevFilters,sortBy:value,offset:0}));};const handleMasterpieceChange=event=>{setProductFilters(prevFilters=>({...prevFilters,masterpiece:event.target.checked?1:''}));};const handleIridescentChange=event=>{setProductFilters(prevFilters=>({...prevFilters,iridescent:event.target.checked?1:''}));};const sortOptions=[{value:'default',label:'По умолчанию'},{value:'price-asc',label:'По возрастанию цены'},{value:'price-desc',label:'По убыванию цены'},{value:'date-desc',label:'По новизне'},{value:'discount-desc',label:'По размеру скидки'}];return/*#__PURE__*/_jsxs(\"section\",{className:\"tag-section\",children:[isBigScreen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-area\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"sorting__button pointer\",onClick:event=>toggleDropdown(0,event),children:/*#__PURE__*/_jsx(\"img\",{src:sorting,alt:\"sort\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-content overflow-hidden \".concat(openDropdownIndex===0?'sorting-content_visible':''),children:/*#__PURE__*/_jsx(\"div\",{className:\"tags__dropdown sorting_by\",children:sortOptions.map(option=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSortChange(option.value),style:{fontWeight:productFilters.sortBy===option.value?'bold':'normal'},children:option.label},option.value))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"sorting-dropdown__button pointer\",onClick:event=>toggleDropdown(5,event),children:[\"\\u0412\\u0441\\u0435 \\u043A\\u0430\\u043C\\u043D\\u0438  \",/*#__PURE__*/_jsx(\"img\",{src:caret,alt:\"caret\",style:{marginLeft:'5px'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-content dropdown_selector \".concat(openDropdownIndex===5?'sorting-content_visible':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tags__dropdown dropdown_selector\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"dropdown_selector\",children:/*#__PURE__*/_jsx(\"input\",{className:\"stone-search\",type:\"text\",onChange:handleStonesInput,placeholder:\"\\u043D\\u0430\\u0447\\u043D\\u0438\\u0442\\u0435 \\u0432\\u0432\\u043E\\u0434\\u0438\\u0442\\u044C \\u043D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"})}),tags&&filteredTags.map(tag=>/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:tag.termId,className:\"tag-button_dropdown\",checked:selectedTags&&selectedTags.some(selectedTag=>selectedTag===tag.termId)?'checked':'',onChange:event=>{event.stopPropagation();// Остановка распространения события клика\nhandleTagToggle(tag.termId);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-pseudo-checkbox pointer\",onClick:event=>event.stopPropagation(),children:[tag.name,!productFilters.category&&/*#__PURE__*/_jsx(\"span\",{className:\"tag-count\",children:tag.count}),\" \"]})]},tag.termId))]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"sorting-button\",onClick:()=>setOpenDropdownIndex(null),children:\"\\u0413\\u043E\\u0442\\u043E\\u0432\\u043E\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"sorting-dropdown__button pointer\",onClick:event=>toggleDropdown(9,event),children:[selectedColors.length>0?\"\\u0426\\u0432\\u0435\\u0442\\u0430 (\".concat(selectedColors.length,\") \"):'Цвета',\" \",/*#__PURE__*/_jsx(\"img\",{src:caret,alt:\"caret\",style:{marginLeft:'5px'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-content dropdown_selector \".concat(openDropdownIndex===9?'sorting-content_visible':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"tags__dropdown dropdown_selector\",children:terms&&terms.colors&&terms.colors.map(color=>/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:color.termId,className:\"tag-button_dropdown\",checked:selectedColors&&selectedColors.some(selectedColor=>selectedColor===color.termId)?'checked':'',onChange:event=>{event.stopPropagation();// Остановка распространения события клика\nhandleColorToggle(color.termId);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-pseudo-checkbox pointer\",onClick:event=>event.stopPropagation(),children:[color.name,/*#__PURE__*/_jsx(\"span\",{className:\"color_ball\",style:{background:color.extra}})]})]},color.termId))}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"sorting-button\",onClick:()=>setOpenDropdownIndex(null),children:\"\\u0413\\u043E\\u0442\\u043E\\u0432\\u043E\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"tag-button\",type:\"checkbox\",checked:productFilters.masterpiece,onChange:handleMasterpieceChange}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-dropdown__button pointer\",children:\"\\u0410\\u0432\\u0442\\u043E\\u0440\\u0441\\u043A\\u0438\\u0435 \\u0443\\u043A\\u0440\\u0430\\u0448\\u0435\\u043D\\u0438\\u044F\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"tag-button\",type:\"checkbox\",checked:productFilters.iridescent,onChange:handleIridescentChange}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-dropdown__button pointer\",children:\"\\u041E\\u043F\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u0438\\u0439 \\u044D\\u0444\\u0444\\u0435\\u043A\\u0442\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-area\",children:tags&&filteredTags.slice(0,15).map(tag=>/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:tag.termId,className:\"tag-button\",checked:selectedTags&&selectedTags.some(selectedTag=>selectedTag===tag.termId)?'checked':'',onChange:()=>handleTagToggle(tag.termId)}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-pseudo-button pointer\",children:[tag.name,!productFilters.category&&/*#__PURE__*/_jsx(\"span\",{className:\"tag-count\",children:tag.count}),\" \"]})]},tag.termId))})]}),isSmallScreen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-area\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tags_flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"sorting__button pointer\",onClick:event=>toggleDropdown(0,event),children:/*#__PURE__*/_jsx(\"img\",{src:sorting,alt:\"sort\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-content overflow-hidden \".concat(openDropdownIndex===0?'sorting-content_visible':''),children:/*#__PURE__*/_jsx(\"div\",{className:\"tags__dropdown sorting_by\",children:sortOptions.map(option=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSortChange(option.value),style:{fontWeight:productFilters.sortBy===option.value?'bold':'normal'},children:option.label},option.value))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"sorting-dropdown__button pointer\",onClick:event=>toggleDropdown(12,event),children:[\"\\u041A\\u0430\\u0442\\u0435\\u0433\\u043E\\u0440\\u0438\\u0438 \",/*#__PURE__*/_jsx(\"img\",{src:caret,alt:\"caret\",style:{marginLeft:'5px'}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-content dropdown_selector \".concat(openDropdownIndex===12?'sorting-content_visible':''),children:/*#__PURE__*/_jsx(\"div\",{className:\"tags__dropdown dropdown_selector\",children:categories&&categories.map(category=>/*#__PURE__*/_jsx(NavLink,{to:\"\",className:\"tag-pseudo-checkbox\",onClick:handleCategoryClick,\"data-id\":category.termId,style:{marginBottom:'5px'},children:category.name},category.termId))})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tags_flex\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"tag-button\",type:\"checkbox\",checked:productFilters.masterpiece,onChange:handleMasterpieceChange}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-dropdown__button pointer\",children:\"\\u0410\\u0432\\u0442\\u043E\\u0440\\u0441\\u043A\\u043E\\u0435 \\u0443\\u043A\\u0440\\u0430\\u0448\\u0435\\u043D\\u0438\\u0435\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"tag-button\",type:\"checkbox\",checked:productFilters.iridescent,onChange:handleIridescentChange}),/*#__PURE__*/_jsx(\"div\",{className:\"sorting-dropdown__button pointer\",children:\"\\u041E\\u043F\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u0438\\u0439 \\u044D\\u0444\\u0444\\u0435\\u043A\\u0442\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-area_mobile\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-dropdown\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"tag-pseudo-button pointer\",onClick:event=>toggleDropdown(9,event),children:[selectedColors.length>0?\"\\u0426\\u0432\\u0435\\u0442 (\".concat(selectedColors.length,\") \"):'Цвет',/*#__PURE__*/_jsx(\"img\",{src:caret,alt:\"caret\",style:{marginLeft:'5px'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sorting-content dropdown_selector \".concat(openDropdownIndex===9?'sorting-content_visible':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"tags__dropdown dropdown_selector\",children:terms&&terms.colors&&terms.colors.map(color=>/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:color.termId,className:\"tag-button_dropdown\",checked:selectedColors&&selectedColors.some(selectedColor=>selectedColor===color.termId)?'checked':'',onChange:event=>{event.stopPropagation();// Остановка распространения события клика\nhandleColorToggle(color.termId);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-pseudo-checkbox pointer\",onClick:event=>event.stopPropagation(),children:[color.name,/*#__PURE__*/_jsx(\"span\",{className:\"color_ball\",style:{background:color.extra}})]})]},color.termId))}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"sorting-button\",onClick:()=>setOpenDropdownIndex(null),children:\"\\u0413\\u043E\\u0442\\u043E\\u0432\\u043E\"})]})]}),tags&&filteredTags.map(tag=>/*#__PURE__*/_jsxs(\"label\",{className:\"tag-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:tag.termId,className:\"tag-button\",checked:selectedTags&&selectedTags.some(selectedTag=>selectedTag===tag.termId)?'checked':'',onChange:()=>handleTagToggle(tag.termId)}),/*#__PURE__*/_jsxs(\"div\",{className:\"tag-pseudo-button pointer\",children:[tag.name,!productFilters.category&&/*#__PURE__*/_jsx(\"span\",{className:\"tag-count\",children:tag.count}),\" \"]})]},tag.termId))]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chosen-area\",children:selectedCategoryName&&/*#__PURE__*/_jsxs(\"h1\",{className:\"category-header\",children:[\"\\u2022 \",selectedCategoryName.toUpperCase(),\" \\u2022\"]})})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}