{"ast":null,"code":"import'./Profile.css';import productsApi from'../../utils/Api';import MobileNavBar from\"../MobileNavBar/MobileNavBar\";import Skeleton from'react-loading-skeleton';import{useMediaQuery}from'react-responsive';import{useEffect,useState}from\"react\";import caretIcon from'../../images/caret-down.svg';import usersApi from'../../utils/UsersApi';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Orders(_ref){let{orders,terms,onCatClick,onBurgerClick,onBurgerClose,isBurgerOpen,cart,isLoggedIn}=_ref;// console.log(orders)\nuseEffect(()=>{document.title='Мои заказы — Долина самоцветов';},[]);const[isCanceled,setIsCanceled]=useState(false);const[timeLeft,setTimeLeft]=useState({});// Состояние для отслеживания оставшегося времени\n// Функция для расчета оставшегося времени\nconst calculateRemainingTime=createdAt=>{const twoHours=2*60*60*1000;// 2 часа в миллисекундах\nconst orderTime=new Date(createdAt*1000).getTime();const currentTime=Date.now();return twoHours-(currentTime-orderTime);};const formatTime=time=>{if(time<=0)return'00:00:00';const hours=Math.floor(time/(1000*60*60)%24);const minutes=Math.floor(time/(1000*60)%60);const seconds=Math.floor(time/1000%60);return\"\".concat(String(hours).padStart(2,'0'),\":\").concat(String(minutes).padStart(2,'0'),\":\").concat(String(seconds).padStart(2,'0'));};// Устанавливаем оставшееся время для каждого заказа при рендеринге\nuseEffect(()=>{if(orders){const intervalId=setInterval(()=>{const newTimeLeft={};orders.forEach(order=>{newTimeLeft[order.orderId]=calculateRemainingTime(order.createdAt);});setTimeLeft(newTimeLeft);},1000);// Обновляем каждую секунду\nreturn()=>clearInterval(intervalId);// Очищаем интервал при размонтировании компонента\n}},[orders]);if(!orders){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}function getDate(timestamp){return new Date(timestamp*1000).toLocaleDateString('ru-RU');}const getStatusName=index=>{switch(index){case 0:return'Новый';case 1:return'Собираем заказ';case 2:return'В пути';case 3:return'Готов к выдаче';case 4:return'Получен';case-1:return'Отменён';default:return'';}};const getStatusClass=index=>{switch(index){case 0:return'status-new';case 1:return'status-collecting';case 2:return'status-on-the-way';case 3:return'status-delivered';case 4:return'status-done';case-1:return'status-cancelled';default:return'';}};const getDeliveryTypeName=index=>{switch(index){case 1:return'Пункт выдачи СДЭК';case 2:return'Курьерская доставка СДЭК';case 3:return'Почта';case 4:return'Пункт выдачи Boxberry';case 5:return'Курьерская доставка Boxberry';case 6:return'5post';default:return'';}};function handlePayClick(orderId){usersApi.orderPay(orderId).then(res=>{window.location.href=res.paymentUrl;});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"main\",{className:\"orders\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"orders-list\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"orders__title\",children:\"\\u0417\\u0430\\u043A\\u0430\\u0437\\u044B\"}),!orders?/*#__PURE__*/_jsx(\"li\",{className:\"order\",children:/*#__PURE__*/_jsx(Skeleton,{height:245,width:\"100%\"})}):orders.length===0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{style:{margin:'0 15px'},children:\"\\u041F\\u043E\\u043A\\u0430 \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432 \\u043D\\u0435\\u0442\"})}):orders.map(order=>/*#__PURE__*/_jsxs(\"li\",{className:\"order\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex_type_row order__head\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"order__header\",children:[\"\\u0417\\u0430\\u043A\\u0430\\u0437 \\u043E\\u0442 \",getDate(order.createdAt)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"order__total-price\",children:[order.totalPrice+order.deliveryPrice,\" \\u20BD\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order__body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order__main-info\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"order__status \".concat(getStatusClass(order.orderStatus)),children:getStatusName(order.orderStatus)}),order.orderStatus===4?/*#__PURE__*/_jsx(\"a\",{href:\"https://dolina.shop/reviews\",children:/*#__PURE__*/_jsx(\"p\",{className:\"order__status order__review\",children:\"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432 \\u2661\"})}):null,order.tracking>0?/*#__PURE__*/_jsxs(\"p\",{className:\"order__main-text\",children:[\"\\u0422\\u0440\\u0435\\u043A-\\u043D\\u043E\\u043C\\u0435\\u0440: \",/*#__PURE__*/_jsx(\"span\",{className:\"order_tracking-number\",children:order.tracking})]}):null,/*#__PURE__*/_jsxs(\"p\",{className:\"order__main-text\",children:[\"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430: \",order.orderId]}),/*#__PURE__*/_jsxs(\"p\",{className:\"order__main-text\",children:[getDeliveryTypeName(order.deliveryType),\": \",order.deliveryOffice?order.deliveryOffice:\"\".concat(order.city+', '+order.deliveryAddress)]}),!order.comment?null:/*#__PURE__*/_jsxs(\"p\",{className:\"order__main-text\",children:[\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439 \\u043A \\u0437\\u0430\\u043A\\u0430\\u0437\\u0443: \",order.comment]}),/*#__PURE__*/_jsxs(\"p\",{className:\"order__main-text\",children:[\"\\u0421\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0438: \",order.deliveryPrice,\" \\u20BD\"]}),order.orderStatus===4?null:order.paid===1?/*#__PURE__*/_jsx(\"p\",{className:\"order_paid\",children:\"\\u041E\\u043F\\u043B\\u0430\\u0447\\u0435\\u043D\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"order_not-paid\",children:\"\\u041D\\u0435 \\u043E\\u043F\\u043B\\u0430\\u0447\\u0435\\u043D\"}),order.orderStatus!==-1&&order.paymentType===1&&timeLeft[order.orderId]>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"order__pay-container\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:()=>handlePayClick(order.orderId),className:\"orders_pay\",children:\"\\u041E\\u043F\\u043B\\u0430\\u0442\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"div\",{className:\"order__timer\",children:formatTime(timeLeft[order.orderId])}),\" \"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"order__products\",children:order.orderedProducts.map(product=>/*#__PURE__*/_jsxs(\"div\",{className:\"order__product-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order_flex_row\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"\".concat('/product/'+product.slug+'-'+product.productId),target:\"_blank\",rel:\"noreferrer\",children:/*#__PURE__*/_jsx(\"img\",{className:\"order__pic\",alt:product.title,src:\"https://dolina.shop/photos/\".concat(product.path.slice(0,-4)+\"_preview.jpg\")})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"a\",{className:\"cart-product__title\",href:\"\".concat('/product/'+product.slug+'-'+product.productId),target:\"_blank\",rel:\"noreferrer\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"order__product-title\",children:product.title})}),product.size>0?/*#__PURE__*/_jsxs(\"p\",{className:\"cart-product__size\",children:[\"\\u0420\\u0430\\u0437\\u043C\\u0435\\u0440: \",product.size]}):null]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"order__product-title\",children:[product.price,\" \\u20BD\"]})]},product.id))})]})]},order.orderId))]})}),/*#__PURE__*/_jsx(MobileNavBar,{onBurger:onBurgerClick,isBurgerOpen:isBurgerOpen,onBurgerClose:onBurgerClose,cart:cart,orders:orders,onCatClick:onCatClick,isLoggedIn:isLoggedIn})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}